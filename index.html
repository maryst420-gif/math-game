<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¨Ø§Ø²ÛŒ Ø¶Ø±Ø¨ Ø´Ø´Ù…</title>
<style>
body{background:#eef2ff;transition:0.5s;font-family:tahoma;text-align:center;}
#gameBox{max-width:440px;margin:auto;padding:20px;background:#fff;border-radius:22px;box-shadow:0 14px 35px rgba(0,0,0,.2);transition:0.5s;}
.bigInput{width:70%;padding:16px;font-size:18px;border-radius:12px;margin:8px 0;}
.row{display:flex;gap:10px;margin:10px 0;}
.card{flex:1;padding:14px;border-radius:14px;background:#e3e9ff;font-weight:bold;cursor:pointer;transition:.3s;text-align:center;font-size:16px;}
.card.active{background:#5c6bc0;color:#fff;}
#timerBox{padding:16px;background:#ffe082;font-size:22px;cursor:pointer;margin:12px 0;display:flex;align-items:center;justify-content:center;gap:10px;border-radius:50px;transition:0.3s;}
.timerIcon{width:50px;height:50px;background:#ffc107;display:flex;align-items:center;justify-content:center;border-radius:50%;font-size:22px;}
#question{font-size:36px;font-weight:bold;color:#3f51b5;margin:14px 0;}
.answerRow{display:flex;gap:8px;justify-content:center;align-items:center;}
#submitBtn{flex:1;background:linear-gradient(135deg,#3949ab,#1e88e5);color:#fff;font-size:18px;border:none;border-radius:14px;height:56px;font-weight:bold;box-shadow:0 6px 14px rgba(0,0,0,.25);display:flex;align-items:center;justify-content:center;gap:6px;}
#submitBtn:active{transform:scale(.97);}
.answerRow input{flex:2;height:56px;font-size:20px;}
#ok{color:green;font-weight:bold;}
#bad{color:red;font-weight:bold;}
#score{margin-top:12px;font-weight:bold;}
#feedback.correct{color:green;}
#feedback.wrong{color:red;}
.stamp{position:fixed;top:40%;left:50%;transform:translate(-50%,-50%) rotate(-12deg);font-size:40px;padding:22px 34px;border:6px solid;border-radius:20px;background:#fff;z-index:999;text-align:center;}
.green{color:#2e7d32;border-color:#2e7d32;}
.lightgreen{color:#558b2f;border-color:#558b2f;}
.yellow{color:#9e9d24;border-color:#9e9d24;}
.orange{color:#ef6c00;border-color:#ef6c00;}
.red{color:#c62828;}
.stamp button{margin-top:10px;padding:10px 18px;border:none;border-radius:12px;background:#5c6bc0;color:#fff;font-size:18px;cursor:pointer;}
.stamp button:hover{transform:scale(1.05);}
.card.correct{background:#81c784;color:#fff;}
.card.wrong{background:#e57373;color:#fff;}
@media print{#timerBox,.row,.answerRow,button,#feedback{display:none;}body{background:white;}}
</style>
</head>
<body>
<div id="gameBox">

<h2>ğŸ¯ Ø¨Ø§Ø²ÛŒ Ø¶Ø±Ø¨ Ø´Ø´Ù…</h2>
<input id="studentName" class="bigInput" placeholder="ğŸ‘¤ Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²">

<div class="row">
<div class="card active" onclick="setMode('test',this)">ğŸ“ Ø¢Ø²Ù…ÙˆÙ†</div>
<div class="card" onclick="setMode('practice',this)">ğŸ§  ØªÙ…Ø±ÛŒÙ†ÛŒ</div>
</div>

<div class="row">
<div class="card active" onclick="setLevel(this)">ğŸŒ± Ø¢Ø³Ø§Ù†</div>
<div class="card" onclick="setLevel(this)">âš¡ Ù…ØªÙˆØ³Ø·</div>
<div class="card" onclick="setLevel(this)">ğŸ”¥ Ø³Ø®Øª</div>
</div>

<div id="timerBox" onclick="startGame()">
<div class="timerIcon">â±</div> Ø´Ø±ÙˆØ¹
</div>

<div id="question"></div>
<div id="shape"></div>

<div class="answerRow">
<input type="number" id="answer" class="bigInput" placeholder="Ø¬ÙˆØ§Ø¨ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³" onkeydown="if(event.key==='Enter')checkAnswer()">
<button id="submitBtn" onclick="checkAnswer()">Ø«Ø¨Øª Ø¬ÙˆØ§Ø¨</button>
</div>

<div class="row" style="justify-content:center; margin-top:12px;">
<div class="card" onclick="saveReport()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡</div>
<div class="card" onclick="window.print()">ğŸ–¨ Ú†Ø§Ù¾</div>
</div>

<div id="score">âœ… <span id="ok">0</span> | âŒ <span id="bad">0</span></div>
<div id="feedback" style="font-size:24px;font-weight:bold;margin-top:12px;"></div>

</div>

<script>
let mode="test",level="easy";
let a,b,correct;
let ok=0,bad=0,count=0;
let time=15,timer=null;
let studentSaved="";
const okSpan=document.getElementById("ok");
const badSpan=document.getElementById("bad");
const feedback=document.getElementById("feedback");
const submitBtn=document.getElementById("submitBtn");

function setMode(m,el){mode=m;el.parentNode.querySelectorAll('.card').forEach(c=>c.classList.remove('active'));el.classList.add('active');}
function setLevel(el){el.parentNode.querySelectorAll('.card').forEach(c=>c.classList.remove('active'));el.classList.add('active');level=el.innerText;}
function startGame(){if(!studentSaved){if(studentName.value.trim()===""){alert("Ù†Ø§Ù… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†");return;}studentSaved=studentName.value;}ok=bad=count=0;updateScore();newQuestion();}
function getRange(){if(level.includes("Ø¢Ø³Ø§Ù†")) return [1,5];if(level.includes("Ù…ØªÙˆØ³Ø·")) return [2,7];return [3,10];}
function newQuestion(){clearInterval(timer);count++;answer.value="";feedback.innerText="";submitBtn.innerHTML="Ø«Ø¨Øª Ø¬ÙˆØ§Ø¨";let [min,max]=getRange();a=Math.floor(Math.random()*(max-min+1))+min;b=Math.floor(Math.random()*(max-min+1))+min;correct=a*b;question.innerHTML=`${a} Ã— ${b}`;shape.innerHTML="";if(mode==="practice"){for(let i=0;i<a;i++) shape.innerHTML+="â— ".repeat(b)+"<br>";timerBox.innerHTML="ğŸ§  ØªÙ…Ø±ÛŒÙ†ÛŒ";} else{startTimer();}}
function startTimer(){time=15;timerBox.innerHTML='<div class="timerIcon">â±</div> '+time;timer=setInterval(()=>{time--;timerBox.innerHTML='<div class="timerIcon">â±</div> '+time;if(time<=0){clearInterval(timer);bad++;updateScore();showFeedback(false);showBtnIcon(false);checkEnd();}},1000);}
function checkAnswer(){clearInterval(timer);if(Number(answer.value)===correct){ok++;showFeedback(true);showBtnIcon(true);}else{bad++;showFeedback(false);showBtnIcon(false);}updateScore();changeBackground();checkEnd();}
function showFeedback(isCorrect){feedback.innerText = isCorrect?"Ø¯Ø±Ø³Øª!":"Ø§Ø´ØªØ¨Ø§Ù‡!";feedback.className = isCorrect?"correct":"wrong";}
function showBtnIcon(isCorrect){submitBtn.innerHTML = (isCorrect?"âœ”ï¸ ":"âœ–ï¸ ") + "Ø«Ø¨Øª Ø¬ÙˆØ§Ø¨";}
function changeBackground(){const colors=["#e3f2fd","#ffe0b2","#dcedc8","#ffccbc","#f3e5f5","#fff9c4"];document.body.style.background = colors[Math.floor(Math.random()*colors.length)];}
function updateScore(){okSpan.innerText=ok;badSpan.innerText=bad;}
function checkEnd(){if(count>=10){showStamp();saveLocal();return;}setTimeout(newQuestion,600);}
function showStamp(){let text="",cls="";if(bad===0){text="Ø¹Ø§Ù„ÛŒ";cls="green";}else if(bad===1){text="Ø®ÛŒÙ„ÛŒ Ø®ÙˆØ¨";cls="lightgreen";}else if(bad===2){text="Ø®ÙˆØ¨";cls="yellow";}else if(bad===3){text="Ù‚Ø§Ø¨Ù„ Ù‚Ø¨ÙˆÙ„";cls="orange";}else{text="Ø¨ÛŒØ´ØªØ± ØªÙ…Ø±ÛŒÙ† Ú©Ù†";cls="red";}const s=document.createElement("div");s.className="stamp "+cls;s.innerHTML=`<div>${text}</div><div style="font-size:22px;text-align:right">Â«ÛŒØ§ÙˆØ±Ø²Ø§Ø¯Ù‡Â»</div><button onclick='restart()'>Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>`;document.body.appendChild(s);}
function restart(){document.querySelector(".stamp").remove();startGame();}
function saveLocal(){let prev = JSON.parse(localStorage.getItem("mathResults")||"[]");prev.push({name:studentSaved,correct:ok,wrong:bad,level:level,date:new Date().toLocaleString()});localStorage.setItem("mathResults",JSON.stringify(prev));}
function saveReport(){let data = JSON.parse(localStorage.getItem("mathResults")||"[]");let text="Ù†ØªØ§ÛŒØ¬ Ù‡Ù…Ù‡ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†:\n\n";data.forEach(r=>{text+=`Ù†Ø§Ù…: ${r.name}\nØ³Ø·Ø­: ${r.level}\nØ¯Ø±Ø³Øª: ${r.correct}\nØºÙ„Ø·: ${r.wrong}\nØªØ§Ø±ÛŒØ®: ${r.date}\n-----------------\n`;});const blob=new Blob([text],{type:"text/plain"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="Ú©Ø§Ø±Ù†Ø§Ù…Ù‡_Ù‡Ù…Ù‡_Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†.txt";a.click();}
</script>
</body>
</html>
