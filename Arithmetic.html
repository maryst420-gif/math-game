<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ø§Ù„Ú¯ÙˆÛŒ Ø­Ø³Ø§Ø¨ÛŒ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* ======================================================
   Ø¨Ø¯Ù†Ù‡ Ùˆ Ø¨Ø§Ú©Ø³ Ø§ØµÙ„ÛŒ
====================================================== */
body{
    background:#eef2ff;
    font-family:tahoma;
    text-align:center;
    padding:20px
}
#gameBox{
    max-width:500px;
    margin:auto;
    background:#fff;
    padding:25px;
    border-radius:22px;
    box-shadow:0 14px 35px rgba(0,0,0,.25)
}

/* ======================================================
   Ø¨Ø§Ú©Ø³ Ù†Ø§Ù… Ùˆ Ù„ÙˆÚ¯Ùˆ
====================================================== */
.input-wrapper{
    position:relative;
    width:60%;
    margin:12px auto;
    height:50px;
}
.bigInput{
    width:100%;
    height:100%;
    padding-right:60px;
    font-size:18px;
    border-radius:14px;
    box-sizing:border-box
}
.logo-link{
    position:absolute;
    right:0;
    top:0;
    height:100%;
    display:flex;
    align-items:center;
    padding-right:6px
}
.logo-link img{
    height:90%;
    animation:seesaw 1.8s ease-in-out infinite;
    transform-origin:center bottom
}
@keyframes seesaw{
    0%{transform:rotate(-10deg)}
    50%{transform:rotate(10deg)}
    100%{transform:rotate(-10deg)}
}

/* ======================================================
   ÙØ±Ù…ÙˆÙ„
====================================================== */
#formula{
    margin:6px 0 10px;
    font-weight:bold;
    font-size:16px;
    line-height:1.4
}
#formula .plus{color:#2e7d32}
#formula .minus{color:#c62828}

/* ======================================================
   Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø·Ø­
====================================================== */
.row{
    display:flex;
    gap:10px;
    margin:10px;
    justify-content:center
}
.card{
    flex:1;
    padding:14px;
    border-radius:14px;
    background:#e3e9ff;
    font-weight:bold;
    cursor:pointer;
    transition:.3s
}
.card.active{
    background:#5c6bc0;
    color:#fff
}

/* ======================================================
   Ù†Ù…Ø§ÛŒØ´ Ø³ÙˆØ§Ù„ Ùˆ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§
====================================================== */
#pattern{
    font-size:20px;
    font-weight:bold;
    margin:10px;
    color:#3949ab
}
.options{
    display:flex;
    flex-direction:column;
    gap:8px;
    margin-top:10px
}
.option{
    background:#e3e9ff;
    padding:10px;
    border-radius:10px;
    cursor:pointer
}
.option.correct{background:#4caf50;color:#fff}
.option.wrong{background:#f44336;color:#fff}

/* ======================================================
   Ø§Ù…ØªÛŒØ§Ø²
====================================================== */
#score{margin-top:10px;font-size:18px}
#ok{color:green;font-weight:bold}
#bad{color:red;font-weight:bold}

/* ======================================================
   Ù…Ù‡Ø± Ù¾Ø§ÛŒØ§Ù†ÛŒ
====================================================== */
.stamp{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.55);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:9999
}
.stampBox{
    padding:28px 36px;
    border-radius:22px;
    transform:rotate(-8deg);
    text-align:center;
    color:#000
}
.great{background:#81c784}
.verygood{background:#aed581}
.good{background:#fff59d}
.ok{background:#ffcc80}
.trymore{background:#ef9a9a}

/* ÙÙ‚Ø· Ø²Ù…ÛŒÙ†Ù‡ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒ Ù…Ù‡Ø± Ø³Ø¨Ø² */
.stampBox button{
    background:#4caf50;
    color:#fff;
    margin-top:10px;
    padding:10px 26px;
    font-size:16px;
    border:none;
    border-radius:14px;
    cursor:pointer
}

/* ======================================================
   ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú†Ø§Ù¾
====================================================== */
@media print{
    body *{visibility:hidden}
    #printArea, #printArea *{visibility:visible}
    #printArea{
        position:absolute;
        inset:0;
        background:#fff;
        padding:30px;
        font-family:tahoma;
        text-align:right
    }
}
</style>
</head>

<body>

<div id="gameBox">
<h2>ğŸ¯ Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ø§Ù„Ú¯ÙˆÛŒ Ø­Ø³Ø§Ø¨ÛŒ</h2>

<div class="input-wrapper">
<input id="studentName" class="bigInput" placeholder="Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²">
<a class="logo-link"><img src="https://s6.uupload.ir/files/logos1_f7lj.png"></a>
</div>

<div id="formula">
<div class="plus">ÛŒÚ© Ø¹Ø¯Ø¯ + ÙØ§ØµÙ„Ù‡ Ã— Ø´Ù…Ø§Ø±Ù‡ Ø´Ú©Ù„ = Ø±Ø§Ø¨Ø·Ù‡</div>
<div class="minus">ÛŒÚ© Ø¹Ø¯Ø¯ âˆ’ ÙØ§ØµÙ„Ù‡ Ã— Ø´Ù…Ø§Ø±Ù‡ Ø´Ú©Ù„ = Ø±Ø§Ø¨Ø·Ù‡</div>
</div>

<div class="row">
<div class="card active" onclick="setLevel(this)">Ø¢Ø³Ø§Ù†</div>
<div class="card" onclick="setLevel(this)">Ù…ØªÙˆØ³Ø·</div>
<div class="card" onclick="setLevel(this)">Ø³Ø®Øª</div>
</div>

<div id="pattern"></div>
<div class="options" id="options"></div>

<div id="score">
Ø¯Ø±Ø³Øª: <span id="ok">0</span> | ØºÙ„Ø·: <span id="bad">0</span>
</div>
</div>

<!-- Ù†Ø§Ø­ÛŒÙ‡ Ù…Ø®ØµÙˆØµ Ú†Ø§Ù¾ -->
<div id="printArea" style="display:none">
<h2>Ú¯Ø²Ø§Ø±Ø´ Ø¨Ø§Ø²ÛŒ Ø§Ù„Ú¯ÙˆÛŒ Ø­Ø³Ø§Ø¨ÛŒ</h2>
<p>Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²: <strong id="pName"></strong></p>
<p>ØªØ¹Ø¯Ø§Ø¯ Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª: <strong id="pOk"></strong></p>
<p>ØªØ¹Ø¯Ø§Ø¯ Ù¾Ø§Ø³Ø® ØºÙ„Ø·: <strong id="pBad"></strong></p>
</div>

<script>
let ok=0,bad=0,count=0,correct=0;
let level="Ø¢Ø³Ø§Ù†",firstTime=true,mediumEasyCount=0;

const sndOk=new Audio("https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3");
const sndBad=new Audio("https://assets.mixkit.co/active_storage/sfx/950/950-preview.mp3");

const studentName=document.getElementById("studentName");
const pattern=document.getElementById("pattern");
const optionsDiv=document.getElementById("options");
const okSpan=document.getElementById("ok");
const badSpan=document.getElementById("bad");

function setLevel(el){
    el.parentNode.querySelectorAll('.card').forEach(c=>c.classList.remove('active'));
    el.classList.add('active');
    level=el.innerText;
    if(firstTime && studentName.value.trim()===""){
        alert("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");
        return;
    }
    newRound();
}

function getRandomD(){return Math.floor(Math.random()*3)+1;}
function getRandomStart(){return Math.floor(Math.random()*5)+1;}
function getRandomSentence(){return Math.floor(Math.random()*10)+6;}

function newRound(){
    optionsDiv.innerHTML="";
    count++;
    if(count>10){finish();return;}

    let a1=getRandomStart();
    let d=getRandomD();
    let n=(level==="Ø³Ø®Øª")?getRandomSentence():4;
    if(level==="Ù…ØªÙˆØ³Ø·"){if(mediumEasyCount<5)n=4;else n=getRandomSentence();}

    let nums=[];
    for(let i=0;i<5;i++) nums.push(a1+i*d);

    correct=(level==="Ø¢Ø³Ø§Ù†"||(level==="Ù…ØªÙˆØ³Ø·"&&mediumEasyCount<5))
        ? a1+4*d
        : a1+(n-1)*d;

    pattern.innerText=(level==="Ø³Ø®Øª"||(level==="Ù…ØªÙˆØ³Ø·"&&mediumEasyCount>=5))
        ? `Ø¬Ù…Ù„Ù‡ ${n}Ø§Ù… Ø§ÛŒÙ† Ø¯Ù†Ø¨Ø§Ù„Ù‡ Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒØ¯: ${nums.slice(0,4).join(" ØŒ ")} ØŒ ØŸ`
        : `Ø§Ù„Ú¯Ùˆ: ${nums.slice(0,4).join(" ØŒ ")} ØŒ ØŸ`;

    let totalOptions=(level==="Ø¢Ø³Ø§Ù†")?3:4;
    let correctIndex=Math.floor(Math.random()*totalOptions);
    let used=[correct];

    for(let i=0;i<totalOptions;i++){
        let opt=document.createElement("div");
        opt.className="option";
        let val;
        if(i===correctIndex){val=correct;}
        else{
            do{
                val=correct+(Math.floor(Math.random()*5)+1)*(Math.random()<0.5?-1:1);
            }while(used.includes(val));
            used.push(val);
        }
        opt.innerText=val;
        opt.onclick=()=>checkOption(opt,i===correctIndex);
        optionsDiv.appendChild(opt);
    }
    if(level==="Ù…ØªÙˆØ³Ø·") mediumEasyCount++;
}

function checkOption(el,isCorrect){
    if(isCorrect){ok++;sndOk.play();el.classList.add("correct");}
    else{bad++;sndBad.play();el.classList.add("wrong");}
    okSpan.innerText=ok;
    badSpan.innerText=bad;
    setTimeout(newRound,700);
}

function finish(){
    document.getElementById("pName").innerText=studentName.value;
    document.getElementById("pOk").innerText=ok;
    document.getElementById("pBad").innerText=bad;
    document.getElementById("printArea").style.display="block";

    let text="",cls="";
    if(bad===0){text="Â«Ø¹Ø§Ù„ÛŒÂ»";cls="great";}
    else if(bad===1){text="Â«Ø®ÛŒÙ„ÛŒ Ø®ÙˆØ¨Â»";cls="verygood";}
    else if(bad===2){text="Â«Ø®ÙˆØ¨Â»";cls="good";}
    else if(bad===3){text="Â«Ù‚Ø§Ø¨Ù„ Ù‚Ø¨ÙˆÙ„Â»";cls="ok";}
    else{text="Â«Ø¨ÛŒØ´ØªØ± ØªÙ…Ø±ÛŒÙ† Ú©Ù†Â»";cls="trymore";}

    const s=document.createElement("div");
    s.className="stamp";
    s.innerHTML=`
    <div class="stampBox ${cls}">
        <div style="font-size:30px">${text}</div>
        <div>Â«ÛŒØ§ÙˆØ±Ø²Ø§Ø¯Ù‡Â»</div>
        <button onclick="restart()">Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù†Ø¬Ø§Ù… Ø¨Ø¯Ù‡</button>
        <button onclick="window.print()">Ú†Ø§Ù¾</button>
        <button onclick="saveReport()">Ø°Ø®ÛŒØ±Ù‡</button>
    </div>`;
    document.body.appendChild(s);
}

function restart(){
    document.querySelector(".stamp").remove();
    ok=bad=count=mediumEasyCount=0;
    okSpan.innerText=0;
    badSpan.innerText=0;
    firstTime=false;
    newRound();
}

function saveReport(){
    let content=document.getElementById("printArea").innerText;
    let blob=new Blob([content],{type:"text/plain;charset=utf-8"});
    let link=document.createElement("a");
    link.href=URL.createObjectURL(blob);
    link.download="Ú¯Ø²Ø§Ø±Ø´_Ø§Ù„Ú¯ÙˆÛŒ_Ø­Ø³Ø§Ø¨ÛŒ.txt";
    link.click();
}
</script>

</body>
</html>
